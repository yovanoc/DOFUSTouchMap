<!DOCTYPE html>
<html>
    <head>
        <meta charset='utf-8'>
        <title>DOFUS Touch Map</title>
        <link rel='stylesheet' href='https://unpkg.com/leaflet@1.3.1/dist/leaflet.css'/>
        <script src='https://unpkg.com/leaflet@1.3.1/dist/leaflet.js'></script>
    </head>
    <style>
        html, body, #map {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }
    .leaflet-control-container {
        display: none;
    }
    </style>
    <script>    
        function init() {
            const minZoom = 1;
            const maxZoom = 1; // maxZoom = minZoom, because it's kinda buggy somehow
            // create the map
            const map = L.map('map', {
                minZoom: minZoom,
                maxZoom: maxZoom,
                zoom: 1,
                crs: L.CRS.Simple,
            });

            const bounds = new L.LatLngBounds(map.unproject([0, 8192], maxZoom), map.unproject([10240, 0], maxZoom));

            map.fitBounds(bounds);

            L.tileLayer('./maps/1/{x}/{y}.jpg', {
                minZoom: minZoom,
                maxZoom: maxZoom,
                zoom: 1,
                noWrap: false,
                bounds: bounds,
            }).addTo(map);

            let xy = [0, 0];
            let storeXY = xy;

            map.on('mousemove', (mouseEvent) => {
                xy = mapXYtoDofusXY(mouseEvent);
                if ((xy[0] !== storeXY[0]) || (xy[1] !== storeXY[1])) {
                    storeXY = xy;
                    console.log(xy);
                }
            });

            const cellheight = 4096 / 161; // 4096 = 2x2048 (lat of the map's center). 161 = Number of map between left and right
            const cellwidth = 5120 / 144; // 5120 = 2x2560 (lng of the map's center). 144 = Number of map between the top and the bottom
            const dofus00 = [-2545, +3340]; // Values returned by mouseEvent on dofus "0,0" (could be more precise).

            function mapXYtoDofusXY(mouseEvent) {
                return [
                    Math.round((mouseEvent.latlng.lng - dofus00[1]) / cellwidth),
                    Math.round((-mouseEvent.latlng.lat + dofus00[0]) / cellheight),
                ];
            }
        }
    </script>
    <body onload='init()'>
        <div id='map'></div>
    </body>
</html>
